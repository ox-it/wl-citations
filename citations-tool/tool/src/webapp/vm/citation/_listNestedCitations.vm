<input type="hidden" id="sectionTitleText" value="$tlang.getString("nested.section.title")"/>
<input type="hidden" id="startEditingText" value="$tlang.getString("nested.start.editing.button")"/>
<input type="hidden" id="finishEditingText" value="$tlang.getString("nested.finish.editing.button")"/>
<input type="hidden" id="deleteSectionText" value="$tlang.getString("nested.delete.section.button")"/>
<input type="hidden" id="addSubsectionButtonText" value="$tlang.getString("nested.add.subsection.button")"/>
<input type="hidden" id="deleteButtonConfirmText" value="$tlang.getString("nested.delete.section.confirm")"/>

#if(!$resourceAdd)
	##Banner
	<div class="listTitle sectionButtons" style="background-color:$officialInstBackColour">
	    <h1 style="color:$officialInstTextColour">$resourceTitle</h1>
	</div>
	##Introduction
	#if ($resourceIntroduction)
		#set( $introduction = $resourceIntroduction )
	#else
		#set( $introduction = 'Reading List Introduction' )
	#end
	<div id='sectionInlineEditorDescription' class='editor sectionEditorsectionInlineEditorDescription sectionButtons buttonsDescription'>
		$introduction
	</div>
	<div id="buttonsDescription" class="sectionButtons buttonsDescription">
		<input type="button" id="toggleDescription" class="active" value='$tlang.getString("nested.start.editing.button")'/>
		<input type="button" id="removeSectionDescription" class="active" value='$tlang.getString("nested.delete.section.button")'/>
	</div>
#end

#set( $num = 1 )
## h1 sections
#if($nestedSectionsSize && $nestedSectionsSize > 0)
	#foreach($nestedSection in $nestedCollection.getChildren())
		#set( $editorDivId = 'sectionInlineEditor' + $nestedSection.getLocation() )
		#set( $linkId = 'link' + $nestedSection.getLocation() )
		#set( $toogleId = 'toggle' + $nestedSection.getLocation())
		#set( $removeDivId = 'removeSection' + $nestedSection.getLocation() )
		#set( $addSubsectionId = 'addSubsection' + $nestedSection.getLocation() )
		#set( $addH1SubsectionButtonId = 'addH1SubsectionButton' + $nestedSection.getLocation() )
		#set( $buttonsDiv = 'buttonsDiv' + $nestedSection.getLocation() )
		#set( $num = $num + 1)
		<li id='$linkId' class='months h1Editor sectionEditor' data-value='$nestedSection.getValue()' data-location='$nestedSection.getLocation()'
			data-sectiontype='$nestedSection.getSectiontype()'>
			<div id='$editorDivId' class='editor h1Editor sectionEditor'>
				$!nestedSection.getValue()
			</div>
			<div id="$buttonsDiv" class="sectionButtons">
				<input type="button" id="$toogleId" class="active" value='$tlang.getString("nested.start.editing.button")'/>
				<input type="button" id="$removeDivId" class="active" value='$tlang.getString("nested.delete.section.button")'/>
			</div>

			## h2 sections and citations
			#if($nestedSection.getChildren().size() > 0)
				<ol id="$addSubsectionId" class="h2NestedLevel holdCitations">
					#foreach($h2Section in $nestedSection.getChildren())
						#set( $num = $num + 1)
						#set( $editorDivId = 'sectionInlineEditor' + $h2Section.getLocation() )
						#set( $linkId = 'link' + $h2Section.getLocation() )
						#set( $toogleId = 'toggle' + $h2Section.getLocation())
						#set( $removeDivId = 'removeSection' + $h2Section.getLocation() )
						#set( $addSubsectionId = 'addSubsection' + $h2Section.getLocation() )
						#set( $addH2SubsectionButtonId = 'addH2SubsectionButton' + $h2Section.getLocation() )
						#set( $buttonsDiv = 'buttonsDiv' + $h2Section.getLocation() )

						## if it's a h2 section
						#if ($h2Section.getSectiontype()=='HEADING2')

						<li id='$linkId' class='h2Section' data-value='$h2Section.getValue()' data-location='$h2Section.getLocation()' data-sectiontype='$h2Section.getSectiontype()' style='background: #cef none repeat scroll 0 0;'>
							<div id='$editorDivId' class='editor h2Editor sectionEditor'>
								$!h2Section.getValue()
							</div>
							<div id="$buttonsDiv" class="sectionButtons">
								<input type="button" id="$toogleId" class="active" value='$tlang.getString("nested.start.editing.button")'/>
								<input type="button" id="$removeDivId" class="active" value='$tlang.getString("nested.delete.section.button")'/>
							</div>

							## h3 sections and citations
							#if($h2Section.getChildren().size() > 0)
								<ol id="$addSubsectionId" class="h3NestedLevel holdCitations">
									#foreach($h3Section in $h2Section.getChildren())
										#set( $num = $num + 1)
										#set( $editorDivId = 'sectionInlineEditor' + $h3Section.getLocation() )
										#set( $linkId = 'link' + $h3Section.getLocation() )
										#set( $toogleId = 'toggle' + $h3Section.getLocation())
										#set( $removeDivId = 'removeSection' + $h3Section.getLocation() )
										#set( $addSubsectionId = 'addSubsection' + $h3Section.getLocation() )
										#set( $buttonsDiv = 'buttonsDiv' + $h3Section.getLocation() )


										## if it's a h3 section
										#if ($h3Section.getSectiontype()=='HEADING3')
										<li id='$linkId' class='h3Section' data-value='$h3Section.getValue()' data-location='$h3Section.getLocation()' data-sectiontype='$h3Section.getSectiontype()'>
											<div id='$editorDivId' class='editor h3Editor sectionEditor'>
												$!h3Section.getValue()
											</div>
											<div id="$buttonsDiv" style="padding:5px;">
												<input type="button" id="$toogleId" class="active" value='$tlang.getString("nested.start.editing.button")'/>
												<input type="button" id="$removeDivId" class="active" value='$tlang.getString("nested.delete.section.button")'/>
											</div>

											## nested citations
											#if($h3Section.getChildren().size() > 0)
												<ol id="$addSubsectionId" class="h4NestedLevel holdCitations">
													#foreach($nestedCitation in $h3Section.getChildren())
														#set( $num = $num + 1)
														#set( $citation = $allCitationCollection.getCitation($nestedCitation.getCitationid() ))
														#set( $editorDivId = 'sectionInlineEditor' + $nestedCitation.getLocation() )
														#set( $linkId = 'link' + $nestedCitation.getLocation() )
														#set( $addSubsectionId = 'addSubsection' + $nestedCitation.getLocation() )
														<li id='$linkId' data-citationId='$nestedCitation.getCitationid()' data-location='$num' data-sectiontype='CITATION'>
															#parse( "vm/citation/_nestableCitation.vm" )
														</li>
													#end
												</ol>
											#else
												<ol class="h4NestedLevel holdCitations"></ol>
											#end ##  end of nested citations
										</li>
										## if it's a h2 citation
										#elseif ($h3Section.getSectiontype()=='CITATION')
											## nested citations
											<ol id="$addSubsectionId" class="h4NestedLevel holdCitations">
												#set( $citation = $allCitationCollection.getCitation($h3Section.getCitationid() ))
												<li id='$linkId' data-citationId='$h3Section.getCitationid()' data-location='$num' data-sectiontype='CITATION'>
													#parse( "vm/citation/_nestableCitation.vm" )
												</li>
											</ol>
									#end
									#end
								</ol>
							#else
								<ol class="h3NestedLevel holdCitations"></ol>
							#end 	## end of h3 sections
                            <div style="padding:5px;"><input type="button" id="$addH2SubsectionButtonId" class="active" value='$tlang.getString("nested.add.subsection.button")'/></div>
						</li>
					## if it's a h1 citation
					#elseif ($h2Section.getSectiontype()=='CITATION')
						## nested citations
						<ol id="$addSubsectionId" class="h4NestedLevel holdCitations">
							#set( $citation = $allCitationCollection.getCitation($h2Section.getCitationid() ))
							<li id='$linkId' data-citationId='$h2Section.getCitationid()' data-location='$num' data-sectiontype='CITATION'>
								#parse( "vm/citation/_nestableCitation.vm" )
							</li>
						</ol>
						#end
					#end
				</ol>
			#else
				<ol class="h2NestedLevel holdCitations"></ol>
			#end 	## end of h2 sections
			## h2 section Add Section button
			<div style="padding:5px;"><input type="button" id="$addH1SubsectionButtonId" class="active" value='$tlang.getString("nested.add.subsection.button")'/></div>
		</li>
	#end
#end  ## end of h1 sections

## add section button
<div class="act" id="addSectionDiv">
	<input id="addSectionButton" type="button" name="AddSection" class="active" value="$tlang.getString("nested.add.section.button")"/>
</div>